---
title: "**AdvStDaAn, Worksheet, Week 7**"
author: "Michael Lappert"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    toc: yes
    toc_depth: 3
  html_document:
    toc: yes
    toc_depth: 3
  '': default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('Specific_R_functions/RFn_Plot-lmSim.R')
source('Specific_R_functions/RFn_Plot-glmSim.R')
```

## Exercise 1
### Exercise 1.a)
Turbine Data (cf. Exercise 1 on Worksheet Week 4) Does the GLM that you have ﬁtted in part 1(b) model the data adequately?

```{r}
path <- file.path('Datasets', 'turbines.dat')
df <- read.table(path, header=TRUE)

# Fitted model in w4, 1.b)
glm1.1 <- glm(cbind(Fissures, Turbines-Fissures) ~ Hours, family = binomial, data = df)
summary(glm1.1)
```

Because the response is binomially distributed with m > 1, we can test on overdispersion:
```{r}
1-pchisq(10.331, 9) # if resulting value > 0.05 -> no overdispersion
```

Because the p-value is > than the significance level of 5% we have no evidence against the null hypothesis that $\phi$ = 1 -> no overdispersion.

Or altenatively:
```{r}
qchisq(0.95, df=9) # if resulting value > Residual deviance -> no overdispersion
```

Because the residual deviance is smaller than $q^{\chi^2_9}_{0.95}$ the null hypothesis that $\phi$ = 1 cannot be rejected -> no overdispersion.\

***
### Question 1.a)
*Is the conclusion in the two cells abvoe right? Are these two different methods to come to the same result (looking for overdispersion)?*

***

Performing a residual and sensitivity analysis for the fitted model:
```{r}
par(mfrow=c(2,4))
plot(glm1.1)
plot.glmSim(glm1.1, SEED = 1)
```

#### Interpretation:
1.  Tukey-Anscombe plot: The smoother shows a banana form, however in the stochastic fluctuation the smoother is not extreme.\
=> The assumption of constant expactation is not violated.
2.  Q-Q plot: The data scattersnot fully around the straight line but is within the stochastic fluctuation.\
=> The assumption of Gaussian distributed errors is violated.
3.  Scale-location plot: The smoother has a banana form and stays within the stochastic fluctuation.\
=> There is no evidence against the assumption of constant variance of the residuals.
4.  Residuals vs. Leverage: All observations have Cook's Distance <1 and therewith no too influential points are present. Leverage points > 2 * `r length(glm1.1$coefficients)` [nr. of coefficients] / `r nrow(df)` [nr. of observations] = `r 2 * length(glm1.1$coefficients) / nrow(df)`.\
=> No too influential (dangerous) observations

*CONCLUSION*: The model does fit the data adequately.

### Exercise 1.b)
Premature Birth Data (cf. Exercise 2 on Worksheet Week 4) Does the logit model that you have ﬁtted in part 2(c) model the data adequately?
```{r}
path <- file.path('Datasets', 'birth-weight.dat')
df <- read.table(path, header = TRUE)

# Fitted moodel from 2.c), w4
df$lWeight <- log(df$weight)
glm2.1 <- glm(cbind(Y, m-Y) ~ lWeight, family = binomial, data = df)
summary(glm2.1)

# Checking for overdispersion
1 - pchisq(8.7335, 8)
```

Because the p-value is > than the significance level of 5% we have no evidence against the null hypothesis that $\phi$ = 1 -> no overdispersion.

Residual and sensitivity analysis:
```{r}
par(mfrow=c(2,4))
plot(glm2.1)
plot.glmSim(glm2.1, SEED = 1)
```

None of the model assumptions is violated, no leverage points (>`r 2 * length(glm1.1$coefficients) / nrow(df)`) and no observations with Cook's Distance > 1.

-> The model fits the data adequately.

